{% load static %}
{% load auth_extras %}

{% comment %}
<!-- Barra lateral (visible en desktop) -->
{% endcomment %}
<aside id="desktop-sidebar"
    class="w-64 flex-shrink-0 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 hidden lg:flex flex-col">
    <div class="h-24 flex items-center justify-center px-4 pt-4">
        <div class="flex items-center gap-2">
            <img src="{% static 'images/logo-nuevas-energias-v2.png' %}" alt="Nuevas Energias" style="width: 150px; height: auto;">
        </div>
    </div>
    <nav class="flex-1 px-4 py-6 space-y-2 mt-4">
        {% if view_as_employee or not user|has_group:'Administrador' %}
            <a href="{% url 'ver_perfil' %}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="my-profile">
                <i data-lucide="user-circle"></i>
                <span class="font-medium">Mi Perfil</span>
            </a>
            <a href="{% url 'mis_recibos' %}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="payslips">
                <i data-lucide="receipt"></i>
                <span class="font-medium">Mis Recibos</span>
            </a>
            <a href="{% url 'mis_horarios_empleado' %}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="schedules">
                <i data-lucide="calendar-days"></i>
                <span class="font-medium">Mis Horarios</span>
            </a>
            <a href="{% url 'mis_sanciones' %}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="sanctions">
                <i data-lucide="shield-alert"></i>
                <span class="font-medium">Mis Sanciones</span>
            </a>
            <a href="{% url 'mis_incidentes' %}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="incidents">
                <i data-lucide="alert-triangle"></i>
                <span class="font-medium">Mis Incidentes</span>
            </a>
            <a href="{% url 'mis_asistencias' %}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="attendance">
                <i data-lucide="camera"></i>
                <span class="font-medium">Mis Asistencias</span>
            </a>
        {% else %}
            <a href="/" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="dashboard">
                <i data-lucide="layout-dashboard"></i>
                <span class="font-medium">Inicio</span>
            </a>
            <a href="{% url 'empleados' %}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="employees">
                <i data-lucide="users"></i>
                <span class="font-medium">Empleados</span>
            </a>
            <a href="{% url 'recibos_admin' %}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="payslips">
                <i data-lucide="receipt"></i>
                <span class="font-medium">Recibos</span>
            </a>
            <a href="{% url 'horarios_admin' %}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="schedules">
                <i data-lucide="calendar-days"></i>
                <span class="font-medium">Horarios</span>
            </a>
            <a href="{% url 'ver_todas_sanciones' %}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="sanctions">
                <i data-lucide="shield-alert"></i>
                <span class="font-medium">Sanciones</span>
            </a>
            <a href="{% url 'ver_incidentes' %}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="incidents">
                <i data-lucide="alert-triangle"></i>
                <span class="font-medium">Incidentes</span>
            </a>
            <a href="{% url 'asistencia_admin' %}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="attendance">
                <i data-lucide="camera"></i>
                <span class="font-medium">Asistencia</span>
            </a>
            <a href="{% url 'reportes_home' %}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="reports">
                <i data-lucide="clipboard-list"></i>
                <span class="font-medium">Reportes</span>
            </a>
        {% endif %}
    </nav>
    <div class="px-4 py-4 border-t border-gray-200 dark:border-gray-700">
        <a href="#" onclick="event.preventDefault(); openLogoutModal()" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700">
            <i data-lucide="log-out"></i>
            <span class="font-medium">Cerrar sesión</span>
        </a>
    </div>
</aside>

<aside id="mobile-sidebar"
    class="fixed top-0 left-0 h-full w-64 bg-white dark:bg-gray-800 z-30 flex flex-col sidebar-mobile-closed lg:hidden">
    <div class="h-24 grid grid-cols-[1fr,auto,1fr] items-center px-4 pt-4">
        <div></div> <!-- Espaciador izquierdo -->
        <div class="flex justify-center">
            <img src="{% static 'images/logo-nuevas-energias-v2.png' %}" alt="Nuevas Energias" style="width: 160px; height: 100px;">
        </div>
        <button id="close-mobile-menu" class="p-1 justify-self-end"><i data-lucide="x"></i></button> <!-- Botón de cerrar a la derecha -->
    </div>
    <nav class="flex-1 px-4 py-6 space-y-2 mt-4">
        {% if view_as_employee or not user|has_group:'Administrador' %}
            <a href="{% url 'ver_perfil' %}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="my-profile">
                <i data-lucide="user-circle"></i>
                <span class="font-medium">Mi Perfil</span>
            </a>
            <a href="{% url 'mis_recibos' %}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="payslips">
                <i data-lucide="receipt"></i>
                <span class="font-medium">Mis Recibos</span>
            </a>
            <a href="{% url 'mis_horarios_empleado' %}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="schedules">
                <i data-lucide="calendar-days"></i>
                <span class="font-medium">Mis Horarios</span>
            </a>
            <a href="{% url 'mis_sanciones' %}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="sanctions">
                <i data-lucide="shield-alert"></i>
                <span class="font-medium">Mis Sanciones</span>
            </a>
            <a href="{% url 'mis_incidentes' %}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="incidents">
                <i data-lucide="alert-triangle"></i>
                <span class="font-medium">Mis Incidentes</span>
            </a>
            <a href="{% url 'mis_asistencias' %}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="attendance">
                <i data-lucide="camera"></i>
                <span class="font-medium">Mis Asistencias</span>
            </a>
        {% else %}
            <a href="/" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="dashboard">
                <i data-lucide="layout-dashboard"></i>
                <span class="font-medium">Inicio</span>
            </a>
            <a href="{% url 'empleados' %}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="employees">
                <i data-lucide="users"></i>
                <span class="font-medium">Empleados</span>
            </a>
            <a href="{% url 'recibos_admin' %}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="payslips">
                <i data-lucide="receipt"></i>
                <span class="font-medium">Recibos</span>
            </a>
            <a href="{% url 'horarios_admin' %}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="schedules">
                <i data-lucide="calendar-days"></i>
                <span class="font-medium">Horarios</span>
            </a>
            <a href="{% url 'ver_todas_sanciones' %}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="sanctions">
                <i data-lucide="shield-alert"></i>
                <span class="font-medium">Sanciones</span>
            </a>
            <a href="{% url 'ver_incidentes' %}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="incidents">
                <i data-lucide="alert-triangle"></i>
                <span class="font-medium">Incidentes</span>
            </a>
            <a href="{% url 'asistencia_admin' %}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="attendance">
                <i data-lucide="camera"></i>
                <span class="font-medium">Asistencia</span>
            </a>
            <a href="{% url 'reportes_home' %}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700" data-view="reports">
                <i data-lucide="clipboard-list"></i>
                <span class="font-medium">Reportes</span>
            </a>
        {% endif %}
    </nav>
    <div class="px-4 py-4 border-t border-gray-200 dark:border-gray-700">
        <a href="#" onclick="event.preventDefault(); openLogoutModal()" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-600 hover:text-white dark:hover:bg-red-700">
            <i data-lucide="log-out"></i>
            <span class="font-medium">Cerrar sesión</span>
        </a>
    </div>
</aside>

<!-- Modal: Confirmar Cierre de Sesión (incluido en aside.html) -->
<div id="logout-modal-aside" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4" onclick="closeLogoutModal()">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-md p-6 m-4 text-center" onclick="event.stopPropagation()">
        <div class="mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-red-100 dark:bg-red-900/50">
            <i data-lucide="log-out" class="h-6 w-6 text-red-600 dark:text-red-400"></i>
        </div>
        <h2 class="text-xl font-semibold mt-4">Cerrar Sesión</h2>
        <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">¿Estás seguro de que deseas cerrar tu sesión?</p>
        <div class="mt-6 flex justify-center gap-3">
            <button type="button" onclick="closeLogoutModal()"
                class="px-4 py-2 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500 w-full">
                Cancelar
            </button>
            <a href="{% url 'logout' %}"
                class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 w-full inline-flex items-center justify-center">
                Confirmar
            </a>
        </div>
    </div>
</div>

<script>
    function openLogoutModal() {
        const modal = document.getElementById('logout-modal-aside');
        if (modal) modal.classList.replace('hidden', 'flex');
    }

    function closeLogoutModal() {
        const modal = document.getElementById('logout-modal-aside');
        if (modal) modal.classList.replace('flex', 'hidden');
    }
</script>
